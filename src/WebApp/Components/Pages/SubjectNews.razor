@page "/subject/{subject}"
@using Core.News
@using System.Linq;
@inject GetNews getNews;

<PageTitle>@subject Notícias</PageTitle>

<div class="container">
    <h1 class="text-center mt-4">
        Notícias sobre: @subject
        <i class="bi bi-brightness-high-fill" id="themeIcon" onclick="toggleTheme()" style="cursor: pointer;"></i>
    </h1>

    <div class="text-center mb-4">
        <a href="/" class="btn btn-primary m-1">Home</a>
        @if (allSubjects != null)
        {
        @foreach (var sub in allSubjects)
        {
        <a href="@($"/subject/{sub}")" class="btn btn-outline-primary m-1">@sub</a>
        }
        }
    </div>

    @if (filteredNews != null && filteredNews.Any())
    {
    <div class="row">
        @foreach (var item in filteredNews
        .OrderByDescending(n => n.PublishedAt)
        .DistinctBy(n => n.Title))
        {
        <div class="col-md-4 mb-4">
            <div class="news-card">
                <NewsCard news="@item" />
            </div>
        </div>
        }
    </div>
    }
    else
    {
    <p class="text-center">Nenhuma notícia encontrada para o assunto: @subject</p>
    }
</div>

@code {
[Parameter] public string subject { get; set; } = string.Empty;
private IEnumerable<News>? filteredNews;
private IEnumerable<string>? allSubjects;

protected override async Task OnParametersSetAsync()
{
var result = await getNews.Handle();
if (result is not null)
{
allSubjects = result.Select(n => n.Subject.ToString()).Distinct();
filteredNews = result
.Where(n => n.Subject.ToString() == subject)
.OrderByDescending(n => n.PublishedAt)
.DistinctBy(n => n.Title);
}
}
}

<style>
    .news-card {
        min-height: 300px;
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 1rem;
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .news-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .dark-theme .news-card {
        background-color: #333;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
</style>
